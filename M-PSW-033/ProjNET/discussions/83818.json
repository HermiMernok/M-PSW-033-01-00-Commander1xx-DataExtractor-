[
  {
    "Id": "287899",
    "ThreadId": "83818",
    "Html": "<p>Hello,</p>\r\n<p>Using the WKTs for webmercator / wgs84 from <a href=\"http://projnet.codeplex.com/wikipage?title=CommonWellKnownText\">http://projnet.codeplex.com/wikipage?title=CommonWellKnownText</a>, when i reproject a point from webMercator to WGS84 i'm seeing ~.25 degree shift in Y. &nbsp;PROJ.4 works fine.</p>\r\n<p>&nbsp;</p>\r\n<p>Here is the code:</p>\r\n<p>&nbsp;</p>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">string webMercatorWkt = new StreamReader(Assembly.GetExecutingAssembly().GetManifestResourceStream(&quot;Junk.webMercatorWkt.txt&quot;)).ReadToEnd();</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;string wgs84wkt = new StreamReader(Assembly.GetExecutingAssembly().GetManifestResourceStream(&quot;Junk.wgs84Wkt.txt&quot;)).ReadToEnd();</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CoordinateSystemFactory csFact = new CoordinateSystemFactory();</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;var webMercator = csFact.CreateFromWkt(webMercatorWkt);</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;var wgs84 = csFact.CreateFromWkt(wgs84wkt);</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CoordinateTransformationFactory xformFact = new CoordinateTransformationFactory();</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;var xform = xformFact.CreateFromCoordinateSystems(webMercator, wgs84);</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;double[] sourcePoint = new double[] { -9161319.573, 4563663.442 };</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;var targetpoint = xform.MathTransform.Transform(sourcePoint);</div>\r\n<p>\r\n<p>string webMercatorWkt = new StreamReader(Assembly.GetExecutingAssembly().GetManifestResourceStream(&quot;Junk.webMercatorWkt.txt&quot;)).ReadToEnd();</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;string wgs84wkt = new StreamReader(Assembly.GetExecutingAssembly().GetManifestResourceStream(&quot;Junk.wgs84Wkt.txt&quot;)).ReadToEnd();</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CoordinateSystemFactory csFact = new CoordinateSystemFactory();</p>\r\n<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;var webMercator = csFact.CreateFromWkt(webMercatorWkt);</p>\r\n<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;var wgs84 = csFact.CreateFromWkt(wgs84wkt);</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CoordinateTransformationFactory xformFact = new CoordinateTransformationFactory();</p>\r\n<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;var xform = xformFact.CreateFromCoordinateSystems(webMercator, wgs84);</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;double[] sourcePoint = new double[] { -9161319.573, 4563663.442 };</p>\r\n<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;var targetpoint = xform.MathTransform.Transform(sourcePoint);</p>\r\n</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>Can anyone tell me what the problem might be?</p>\r\n<p>&nbsp;</p>",
    "PostedDate": "2010-02-09T16:08:58.42-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "431272",
    "ThreadId": "83818",
    "Html": "<p>I faced the same problem and I used this instead:</p>\r\n<div style=\"color:Black;background-color:White\">\r\n<pre>        <span style=\"color:Blue\">double</span>[] toMercator(<span style=\"color:Blue\">double</span> lon, <span style=\"color:Blue\">double</span> lat)\r\n        {\r\n            <span style=\"color:Blue\">double</span> x = lon * 20037508.34 / 180;\r\n            <span style=\"color:Blue\">double</span> y = Math.Log(Math.Tan((90 + lat) * Math.PI / 360)) / (Math.PI / 180);\r\n            y = y * 20037508.34 / 180;\r\n            <span style=\"color:Blue\">return</span> <span style=\"color:Blue\">new</span> <span style=\"color:Blue\">double</span>[] {x, y};\r\n        }\r\n        <span style=\"color:Blue\">double</span>[] inverseMercator (<span style=\"color:Blue\">double</span> x, <span style=\"color:Blue\">double</span> y) {\r\n            <span style=\"color:Blue\">double</span> lon = (x / 20037508.34) * 180;\r\n            <span style=\"color:Blue\">double</span> lat = (y / 20037508.34) * 180;\r\n\r\n            lat = 180/Math.PI * (2 * Math.Atan(Math.Exp(lat * Math.PI / 180)) - Math.PI / 2);\r\n            <span style=\"color:Blue\">return</span> <span style=\"color:Blue\">new</span> <span style=\"color:Blue\">double</span>[] {lon, lat};\r\n        }\r\n\r\n</pre>\r\n</div>\r\n<p>It is a pure mathematical implementation of the transform.</p>",
    "PostedDate": "2010-04-14T22:46:29.823-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "554084",
    "ThreadId": "83818",
    "Html": "\r\n<p>Sounds like you might be creating a Mercator projection with respect to the WGS84 ellipsoid, rather than relative to a sphere.</p>\r\n<p>Try adding:</p>\r\n<p>PARAMETER[&quot;semi_minor&quot;,6378137]</p>\r\n<p>into the list of parameters in the WKT of your projection.</p>\r\n<p>See here for more details: http://alastaira.wordpress.com/2011/01/23/the-google-maps-bing-maps-spherical-mercator-projection/</p>\r\n",
    "PostedDate": "2011-01-23T16:12:56.277-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]