[
  {
    "Id": "280272",
    "ThreadId": "81631",
    "Html": "<p>I'm trying to convert a shapefile from the NAD83 (State Plane) projection to the WGS84 (Lat/Long) Projection, but the calculation isn't coming out correctly. My code and results are below:</p>\r\n<p>&nbsp;</p>\r\n<div style=\"color:Black;background-color:White\">\r\n<pre><span style=\"color:Blue\">using</span> SharpMap.CoordinateSystems;\r\n<span style=\"color:Blue\">using</span> SharpMap.CoordinateSystems.Transformations;\r\n<span style=\"color:Blue\">using</span> SharpMap.Data.Providers.ShapeFile;\r\n<span style=\"color:Blue\">using</span> SharpMap.Geometries;\r\n</pre>\r\n</div>\r\n<div style=\"color:Black;background-color:White\">\r\n<pre>CoordinateTransformationFactory ctfac = <span style=\"color:Blue\">new</span> CoordinateTransformationFactory();\r\n<span style=\"color:Blue\">private</span> <span style=\"color:Blue\">string</span> wkt4326 = <span style=\"color:#A31515\">&quot;GEOGCS[\\&quot;GCS_WGS_1984\\&quot;,DATUM[\\&quot;D_WGS_1984\\&quot;,SPHEROID[\\&quot;WGS_1984\\&quot;,6378137,298.257223563]],PRIMEM[\\&quot;Greenwich\\&quot;,0],UNIT[\\&quot;Degree\\&quot;,0.017453292519943295]]&quot;</span>;\r\n<span style=\"color:Blue\">private</span> <span style=\"color:Blue\">string</span> wkt2227 = <span style=\"color:#A31515\">&quot;PROJCS[\\&quot;NAD_1983_StatePlane_California_III_FIPS_0403_Feet\\&quot;,GEOGCS[\\&quot;GCS_North_American_1983\\&quot;,DATUM[\\&quot;D_North_American_1983\\&quot;,SPHEROID[\\&quot;GRS_1980\\&quot;,6378137,298.257222101]],PRIMEM[\\&quot;Greenwich\\&quot;,0],UNIT[\\&quot;Degree\\&quot;,0.0174532925199432955]],PROJECTION[\\&quot;Lambert_Conformal_Conic\\&quot;],PARAMETER[\\&quot;False_Easting\\&quot;,6561666.666666666],PARAMETER[\\&quot;False_Northing\\&quot;,1640416.666666667],PARAMETER[\\&quot;Central_Meridian\\&quot;,-120.5],PARAMETER[\\&quot;Standard_Parallel_1\\&quot;,37.06666666666667],PARAMETER[\\&quot;Standard_Parallel_2\\&quot;,38.43333333333333],PARAMETER[\\&quot;Latitude_Of_Origin\\&quot;,36.5],UNIT[\\&quot;Foot_US\\&quot;,0.304800609601219241]]&quot;</span>;\r\nShapeFileProvider sf = <span style=\"color:Blue\">null</span>;\r\nStringBuilder sb = <span style=\"color:Blue\">new</span> StringBuilder();\r\nICoordinateSystem cs2227 = SharpMap.Converters.WellKnownText.CoordinateSystemWktReader.Parse(wkt2227) <span style=\"color:Blue\">as</span> ICoordinateSystem;\r\nICoordinateSystem cs4326 = SharpMap.Converters.WellKnownText.CoordinateSystemWktReader.Parse(wkt4326) <span style=\"color:Blue\">as</span> ICoordinateSystem;\r\nICoordinateTransformation trans = ctfac.CreateFromCoordinateSystems(cs2227, cs4326);\r\n<span style=\"color:Blue\">try</span>\r\n{\r\n    sf = <span style=\"color:Blue\">new</span> ShapeFileProvider(selectedFilePath);\r\n    sf.Open(<span style=\"color:Blue\">false</span>);\r\n    <span style=\"color:Blue\">if</span> (sf.ShapeType == ShapeType.Polygon)\r\n    {\r\n        <span style=\"color:Blue\">int</span> counter = 0;\r\n        BoundingBox ext = sf.GetExtents();\r\n        IEnumerable&lt;Geometry&gt; geometries = sf.ExecuteGeometryIntersectionQuery(ext);\r\n        <span style=\"color:Blue\">foreach</span> (Geometry geometry <span style=\"color:Blue\">in</span> geometries)\r\n        {\r\n            Polygon polygon = geometry <span style=\"color:Blue\">as</span> Polygon;\r\n            <span style=\"color:Blue\">if</span> (polygon != <span style=\"color:Blue\">null</span>)\r\n            {\r\n                sb.Append(<span style=\"color:#A31515\">&quot;SET @polygon&quot;</span> + counter + <span style=\"color:#A31515\">&quot; = geometry::STGeomFromText('&quot;</span>);\r\n                sb.Append(<span style=\"color:#A31515\">&quot;POLYGON((&quot;</span>);\r\n                <span style=\"color:Blue\">int</span> totalVertices = polygon.ExteriorRing.Vertices.Count;\r\n                Point pt0 = trans.MathTransform.Transform(polygon.ExteriorRing.Vertices[0]);\r\n                <span style=\"color:Blue\">for</span> (<span style=\"color:Blue\">int</span> i = 0; i &lt; totalVertices; i++)\r\n                {\r\n                    Point pt1 = trans.MathTransform.Transform(polygon.ExteriorRing.Vertices[i]);\r\n                    sb.Append(pt1.X + <span style=\"color:#A31515\">&quot; &quot;</span> + pt1.Y);\r\n                    sb.Append(<span style=\"color:#A31515\">&quot;,&quot;</span>);\r\n                }\r\n                sb.Append(pt0.X + <span style=\"color:#A31515\">&quot; &quot;</span> + pt0.Y);\r\n                sb.Append(<span style=\"color:#A31515\">&quot;))&quot;</span>);\r\n                sb.Append(<span style=\"color:#A31515\">&quot;', 4326);&quot;</span>);\r\n            }\r\n            sb.Append(Environment.NewLine);\r\n            counter++;\r\n        }\r\n    }\r\n}\r\n<span style=\"color:Blue\">finally</span>\r\n{\r\n    <span style=\"color:Blue\">if</span> (sf != <span style=\"color:Blue\">null</span>) { sf.Close(); }\r\n}\r\n<span style=\"color:Blue\">return</span> sb.ToString();\r\n</pre>\r\n</div>\r\n<p>My results:</p>\r\n<p style=\"padding-left:30px\">Input: 6139949.19 , 1938696.8 (Easting / Northing)</p>\r\n<p style=\"padding-left:30px\">Output: -125.37538163521, 39.0883958914316</p>\r\n<p style=\"padding-left:30px\">Correct: -121.9501208, 37.3102349</p>\r\n<p>Any help would be greatly appreciated. I've tried using the OGR2OGR tool from FWTools, but I get a very cryptic error, so I've abandoned that effort.</p>\r\n<p>Thanks!</p>",
    "PostedDate": "2010-01-21T14:15:56.017-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "286812",
    "ThreadId": "81631",
    "Html": "<p>Proj.NET does not automatically apply the datum shift. You must specify the TOWGS84 parameter manually. Note that this value might change from place to place (it's rarely a constant value and various from place to place)</p>",
    "PostedDate": "2010-02-07T08:56:04.53-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]